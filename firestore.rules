rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /codes/{codeId} {
      allow read: if true;         // allow anyone to resolve a join code
      allow write: if request.auth != null; // hosts only (or relax during dev)
    }
    // Session documents and their signaling subcollections
    match /sessions/{sessionId} {
      allow read, write: if true;
      match /offers/{doc} { allow read, write: if true; }
      match /answers/{doc} { allow read, write: if true; }
      match /candidates_host/{doc} { allow read, write: if true; }
      match /candidates_viewer/{doc} { allow read, write: if true; }
    }

    // Join codes mapping (code -> sessionId)
    match /codes/{codeId} {
      allow read, write: if true;
    }
  }
}